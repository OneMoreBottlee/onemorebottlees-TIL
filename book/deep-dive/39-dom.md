# 39장 DOM

이전 장에서 살펴본 바와 같이 브라우저의 렌더링 엔진이 HTML 문서를 파싱하여 브라우저가 이해할 수 있는 자료구조 DOM을 생성한다. DOM은 HTML 문서의 계층적 구조와 정보를 표현하며 이를 제어할 수 있는 API, 즉 프로퍼티와 메서드를 제공하는 트리 자료구조다.

### 39.1 노드

#### 39.1.1 HTML 요소와 노드 객체

HTML 요소는 HTML 문서를 구성하는 개별적인 요소를 의미한다.

```javascript
<div class="greeting"> Hello </div>
//시작태그 어트리뷰트     콘텐츠  종료태그
```

HTML 요소는 렌더링 엔진에 의해 파싱되어 DOM을 구성하는 요소 노드 객체로 변환된다. 이때 HTML 요소의 어트리뷰트는 어트리뷰트 노드로, HTML 요소의 텍스트 콘텐츠는 텍스트 노드로 변환된다.&#x20;

HTML 문서는 HTML 요소들의 집합으로 이루어지며, 각 요소는 중첩 관계를 갖는다. 즉, HTML 요소의 콘텐츠 영역에는 텍스트뿐 아니라 다른 HTML 요소도 포함될 수 있다. 이때 HTML 요소 간에는 중첩 관계에 의한 계층적 부자 관계가 형성된다. 이러한 HTML 요소 간 관계를 반영하여 모든 노드 객체들을 트리 자료 구조로 구성하게 된다.



트리 자료 구조

노드들의 계층 구조로 이루어진다. 부모 노드와 자식 노드로 구성되어 노드 간 계층 구조를 표현하는 비선형 자료구조를 의미한다. 하나의 최상위 노드로부터 시작하며, 0개 이상의 자식 노드를 갖는다. 자식 노드가 없는 노드는 리프 노드라 한다. 이러한노드 객체들로 구성된 트리 자료구조를 DOM이라 한다. 트리로 구조화 되어 DOM 트리라 부르기도 한다.



#### 39.1.2 노드 객체의 타입

DOM은 노드 객체의 계층적 구조로 구성된다. 노드 객체는 12개의 종류가 있고 상속 구조를 가지는게 특징이다. 대표적인 노드 객체는 다음과 같다.



*   문서 노드

    DOM 트리 최상위에 존재하는 루트 노드로서 document 객체를 가리킨다. 브라우저가 렌더링한 HTML 문서 전체를 가리키는 객체로서 전역 객체 window의 document 프로퍼티에 바인딩되어 있다. 따라서 window.document 또는 document로 참조 가능하다.\
    브라우저 환경의 모든 JS 코드는 script 태그에 의해 분리되어 있어도 하나의 전역 객체 window를 공유한다. 따라서 HTML 문서당 document 객체는 유일하다. DOM 트리의 루트 노드이므로 진입점 역할을 담당한다.
*   요소 노드

    HTML 요소를 가리키는 객체다. 요소 간 중첩에 의해 부자 관계를 가지며, 이 관계를 통해 정보를 구조화한다. 따라서, 문서의 구조를 표현한다고 할 수 있다.
*   어트리뷰트 노드

    HTML 요소의 어트리뷰트를 가리키는 객체다. 어트리뷰트가 지정된 HTML 요소의 요소 노드와 연결되어 있다. (단, 부모 노드와 연결되어 있지 않음.) 따라서 어트리뷰트 노드에 접근하려면 먼저 요소 노드에 접근해야 한다.
*   텍스트 노드

    HTML 요소의 텍스트를 가리키는 객체다. 문서의 정보를 표현하고, 요소 노드의 자식 노드이며, 리프 노드이다. 즉, 텍스트 노드는 DOM 트리의 최종단이다. 따라서 텍스트 노드에 접근하려면 먼저 요소 노드에 접근해야 한다.



이 외에도 주석을 위한 Comment 노드, DocumentType 노드, DocumentFragment 노드 등 총 12개의 노드 타입이 있다.



#### 39.1.3 노드 객체의 상속 구조 (p.681 \~ 그림 보면서 같이 공부)

DOM을 구성하는 노드 객체는 자신의 구조와 정보를 제어할 수 있는 DOM API를 사용할 수 있다. 이를 통해 노드 객체는 자신의 부모, 형제, 자식 노드를 탐색할 수 있으며, 어트리뷰트와 텍스트를 조작할 수 있다.

노드 객체는 표준 빌트인 객체가 아닌 브라우저 환경에서 추가적으로 제공하는 호스트 객체다.

Object > EventTarget > Node 인터페이스를 상속받는다.

노드 객체에는 노드 객체의 종류(타입)에 상관없이 모든 노드 객체가 공통으로 갖는 기능도 있고, 타입별 기능도 있다.

요소 노드 객체는 HTML 요소가 갖는 공통적 기능이 있다. 예를 들어, input과 div는 모두 style 프로퍼티가 있다. 이처럼 HTML 요소가 갖는 공통적 기능은 HTMLElement 인터페이스가 제공한다.

요소의 종류에 따라 고유한 기능도 있다. 예를 들어 input은 value 프로퍼티가 필요하지만 div에는 필요하지 않다. 따라서 필요한 기능을 제공하는 인터페이스가 HTML 요소의 종류에 따라 각각 다르다.

이처럼 노드 객체는 공통 기능일수록 프로토타입 체인의 상위에, 개별적 기능일 수록 하위에 프로토타입 체인을 구축하여 노드 객체에 필요한 기능, 즉 프로퍼티와 메서드를 제공하는 상속 구조를 갖는다.



**2줄 요약**

> DOM 은 HTML 문서의 계층적 구조와 정보를 표현하고, 노드 타입에 따라 필요한 기능을 DOM API로 제공한다. DOM API를 통해 HTML 구조와 내용, 스타일을 동적으로 조작할 수 있다 !



### 39.2 요소 노드 취득

HTML 구조, 내용, 스타일링을 동적으로 조작하려면 요소 노드 취득이 우선이다.

예를 들어, h1 요소의 텍스트를 변경하려면 DOM 트리 내 존재하는 h1 요소 노드를 취득하고, 취득한 요소 노드의 자식 노드인 텍스트 노드를 변경하면 해당 h1 요소의 텍스트가 변경된다.

이처럼 요소 노드의 취득은 HTML 요소를 조작하는 시작점이다. 이를 위해 DOM은 요소 노드를 취득할 수 있는 다양한 메서드를 제공한다.

#### 39.2.1 id를 이용한 요소 노드 취득

Document.prototype.getElementById() 메서드는 인수로 전달한 id 어트리뷰트 값을 갖는 하나의 요소 노드를 탐색하여 반환한다.

id 값은 HTML 문서 내 유일한 값이어야 하며, class 어트리뷰트와 달리 공백 문자로 구분하여도 여러 개의 값을 가질 수 없다. 하지만 HTML 문서 내 중복된 id 값을 갖는 HTML 요소가 여러 개 존재하더라도 우리의 JS는 에러를 발생하지 않는다. 이러한 경우 첫 번째 요소 노드만 반환한다.



#### 39.2.2 태그 이름을 이용한 요소 노드 취득

Document.prototype.getElementsByTagName()

Element.prototype.getElementsByTagName()

메서드는 인수로 전달된 태그 이름을 갖는 모든 요소 노드들을 탐색하여 반환한다. 메서드에 포함된 Elements가 복수형인 것에서 알 수 있듯이 여러 개의 요소 노드 객체를 갖는 HTMLCollection 객체를 반환한다.

함수는 하나의 값만 반환할 수 있으므로 여러 개의 값을 반환하려면 배열이나 객체와 같은 자료구조에 담아 반환한다. HTML 문서의 모든 요소 노드를 취득하려면 인수로 \*을 전달한다.

Document - 메서드는 DOM의 루트 노드인 문서 노드, document를 통해 호출하며 DOM 전체에서 요소 노드를 탐색하여 반환한다.\
Element - 메서드는 특정 요소 노드를 통해 호출하며, 특정 요소 노드의 자손 노드 중 요소 노드를 탐색하여 반환한다.

탐색값이 없다면 빈 HTMLCollection 객체를 반환한다.



#### 39.2.3 class를 이용한 요소 노드 취득

Document.prototype.getElementsByClassName()

Element.prototype.getElementsByClassName()

메서드는 인수로 전달한 class 어트리뷰트 값을 갖는 모든 요소 노드들을 탐색하여 반환한다. 인수로 전달할 class 값은 공백으로 구분하여 여러 class를 지정할 수 있다.

getElementByTagName 메서드와 마찬가지로 \
Document - 메서드는 DOM의 루트 노드인 document를 통해 호출하며 DOM 전체에서 요소 노드를 탐색하여 반환한다.\
Element - 메서드는 특정 요소 노드를 통해 호출하며 특정 요소 노드의 자손 노드 중 요소 노드를 탐색하여 반환한다.

탐색값이 없다면 빈 HTMLCollection 객체를 반환한다.



#### 39.2.4 CSS 선택자를 이용한 요소 노드 취득

CSS 선택자는 스타일을 적용하고자 하는 HTML 요소를 특정할 때 사용하는 문법이다.

Document.prototype.querySelector()

Element.prototype.querySelector()

메서드는 인수로 전달한 CSS 선택자를 만족시키는 하나의 요소 노드를 탐색하여 반환한다.

* 인수로 전달한 CSS 선택자를 만족시키는 요소 노드가 여러 개인 경우 첫 번째 요소 노드만 반환한다.
* 인수로 전달된 CSS 선택자를 만족시키는 요소 노드가 존재하지 않는 경우 null을 반환한다.
* 인수로 전달한 CSS 선택자가 문법에 맞지 않는 경우 DOMException 에러가 발생한다.



Document.prototype.querySelectorAll()

Element.prototype.querySelectorAll()

메서드는 인수로 전달한 CSS 선택자를 만족시키는 모든 요소 노드를 탐색하여 반환한다.

* 인수로 전달된 CSS 선택자를 만족시키는 요소가 존재하지 않는 경우 빈 NodeList 객체를 반환한다.
* 인수로 전달한 CSS 선택자가 문법에 맞지 않는 경우 DOMException 에러가 발생한다.

HTML 요소의 모든 요소 노드를 취득하려면 인수로 \*를 전달한다.



getElementByTagName 메서드와 마찬가지로 \
Document - 메서드는 DOM의 루트 노드인 document를 통해 호출하며 DOM 전체에서 요소 노드를 탐색하여 반환한다.\
Element - 메서드는 특정 요소 노드를 통해 호출하며 특정 요소 노드의 자손 노드 중 요소 노드를 탐색하여 반환한다.



CSS 선택자 문법을 사용하는 querySelector, querySelectorAll 메서드는 위의 두 메서드보다 다소 느리다고 알려져있지만, 좀 더 구체적인 조건으로 요소 노드를 취득할 수 있고, 일관된 방식으로 요소 노드를 취득할 수 있다는 장점이 있다. 따라서 id 어트리뷰트가 있는 경우 외에는 querySelector, querySelectorAll 메서드를 권장한다고 한다.



#### 39.2.5 특정 요소 노드를 취득할 수 있는지 확인

Element.prototype.matches() 메서드는 인수로 전달한 CSS 선택자를 통해 특정 요소 노드를 취득할 수 있는지 확인한다. 이벤트 위임을 사용할 때 유용한 메서드이다.



#### 39.2.6 HTMLCollection과 NodeList

DOM 컬렉션 객체인 HTMLCollection과 NodeList는 DOM API가 여러 개의 결과값을 반환하기 위한 DOM 컬렉션 객체이다. 노드 객체의 상태 변화를 실시간으로 반영하는 살아있는 객체라는 특징이 있다.



HTMLCollection

getElementsByTagName, getElementsByClassName 메서드가 반환하는 이 객체는 노드 객체의 상태 변화를 실시간으로 반영하는 살아있는 DOM 컬렉션 객체이다. 따라서 살아있는 객체라고 부르기도 한다.

주의점 - p.695 - 697 예제 확인

for 문을 역방향으로 순회하거나, while문으로 객체에 노드 객체가 없을때까지 반복하거나 HTMLCollection 객체를 사용하지 않고 배열로 변환해 고차 함수를 사용하는 방법을 사용한다.



NodeList

HTMLCollection과 달리 대부분의 경우실시간으로 상태변경을 반영하지 않는 객체다. NodeList.prototype.forEach 메서드를 상속받아 사용할 수 있다. (item, entries, keys, values 등)

하지만, childNodes 프로퍼티가 반환하는 NodeList 객체는 실시간으로 노드 객체의 상태 변경을 반영하는 live 객체로 동작하므로 주의해야 한다.



이처럼 HTMLCollection과 NodeList는 예상과 다르게 동작할 수 있어 다루기 까다롭다. 따라서 노드 객체의 상태 변경과 상관없이 안전하게 DOM 컬렉션을 사용하려면 객체를 배열로 변환하여 사용하는 것이 권장된다.



너무 덥다 오늘은 여기까지 -

